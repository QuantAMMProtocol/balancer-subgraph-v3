type Vault @entity {
  id: Bytes!
  authorizer: Bytes!
  isPaused: Boolean!
  protocolSwapFee: BigDecimal!
  protocolYieldFee: BigDecimal!
  pools: [Pool!] @derivedFrom(field: "vault")
}

type Pool @entity {
  id: Bytes!
  vault: Vault!
  factory: Bytes!
  address: Bytes!
  totalShares: BigInt!
  pauseManager: Bytes!
  pauseWindowEndTime: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!

  tokens: [PoolToken!] @derivedFrom(field: "pool")
  rateProviders: [RateProvider!] @derivedFrom(field: "pool")
}

type PoolToken @entity {
  id: Bytes!
  pool: Pool!
  address: Bytes!
  balance: BigInt!
  totalProtocolSwapFee: BigInt!
  totalProtocolYieldFee: BigInt!
}

type RateProvider @entity {
  id: Bytes!
  pool: Pool!
  token: PoolToken!
  address: Bytes!
}

type Swap @entity(immutable: true) {
  id: Bytes!
  pool: Bytes!
  tokenIn: Bytes!
  tokenOut: Bytes!
  tokenAmountIn: BigInt!
  tokenAmountOut: BigInt!
  swapFeeAmount: BigInt!
  user: User!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

enum InvestType {
  Join
  Exit
}

type JoinExit @entity(immutable: true) {
  id: ID!
  type: InvestType!
  sender: Bytes!
  amounts: [BigInt!]!
  pool: Pool!
  user: User!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type PoolShare @entity {
  id: ID!
  pool: Pool!
  user: User!
  balance: BigInt!
}

type PoolSnapshot @entity {
  id: ID!
  pool: Pool!
  timestamp: Int!
  totalShares: BigInt!
  balances: [BigInt!]!
  totalProtocolSwapFees: [BigInt!]!
  totalProtocolYieldFees: [BigInt!]!
}

type User @entity {
  id: ID!
  swaps: [Swap!] @derivedFrom(field: "user")
  shares: [PoolShare!] @derivedFrom(field: "user")
  joinExits: [JoinExit!] @derivedFrom(field: "user")
}
