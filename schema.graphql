type Pool @entity {
  id: Bytes!
  factory: Bytes!
  totalShares: BigInt!
  pauseWindowEndTime: BigInt!
  pauseManager: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!

  tokens: [PoolToken!] @derivedFrom(field: "pool")
  rateProviders: [PoolToken!] @derivedFrom(field: "pool")
}

type PoolToken @entity {
  id: Bytes!
  pool: Pool!
  address: Bytes!
  balance: BigInt!
}

type RateProvider @entity {
  id: Bytes!
  pool: Pool!
  token: PoolToken!
  address: Bytes!
}

type Swap @entity(immutable: true) {
  id: Bytes!
  pool: Bytes!
  tokenIn: Bytes!
  tokenOut: Bytes!
  tokenAmountIn: BigInt!
  tokenAmountOut: BigInt!
  swapFeeAmount: BigInt!
  user: User!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

enum InvestType {
  Join
  Exit
}

type JoinExit @entity(immutable: true) {
  id: ID!
  type: InvestType!
  sender: Bytes!
  amounts: [BigInt!]!
  pool: Pool!
  user: User!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type PoolShare @entity {
  id: ID!
  pool: Pool!
  user: User!
  balance: BigInt!
}

type PoolSnapshot @entity {
  id: ID!
  pool: Pool!
  timestamp: Int!
  balances: [BigInt!]!
  totalShares: BigInt!
}

type User @entity {
  id: ID!
  swaps: [Swap!] @derivedFrom(field: "user")
  shares: [PoolShare!] @derivedFrom(field: "user")
}
